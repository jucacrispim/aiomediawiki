UNITTEST_COVERAGE:  &UNITTEST_COVERAGE
   name: Unit tests coverage
   command: ./build-scripts/check_coverage.sh
   timeout: 20


FUNCTIONAL_TESTS:  &FUNCTIONAL_TESTS
   name: Functional tests
   command: pytest tests/functional
   timeout: 20


PYLINT:  &PYLINT
  name: Code linter
  command: sh ./build-scripts/run_linter.sh
  warning_on_fail: true


PEP8:  &PEP8
  name: Checking code conventions
  command: flake8 mediawiki tests
  warning_on_fail: true


MAIN_STEPS:  &MAIN_STEPS
  - <<: *PEP8
  - <<: *PYLINT
  - <<: *UNITTEST_COVERAGE
  - <<: *FUNCTIONAL_TESTS


PY35_VENV: &PY35_VENV
  name: python-venv
  pyversion: python3.5
  requirements_file: requirements.txt

PY36_VENV:  &PY36_VENV
  name: python-venv
  pyversion: python3.6
  requirements_file: requirements.txt

PY37_VENV:  &PY37_VENV
  name: python-venv
  pyversion: python3.7
  requirements_file: requirements.txt




# builders

PY35_BUILDER:  &PY35_BUILDER
  name: python3.5

  branches:
    - master

  plugins:
    - <<: *PY35_VENV

  steps:
    *MAIN_STEPS

  platform:
    python3.5


PY36_BUILDER:  &PY36_BUILDER
  name: python3.6

  branches:
    - master

  plugins:
    - <<: *PY36_VENV

  steps:
    *MAIN_STEPS

  platform:
    python3.6


PY37_BUILDER:  &PY37_BUILDER
  name: python3.7

  branches:
    - master
    - 'feature-*'
    - 'bug-*'

  plugins:
    - <<: *PY37_VENV

  steps:
    *MAIN_STEPS

  platform:
    python3.7



builders:
  - <<: *PY35_BUILDER
  - <<: *PY36_BUILDER
  - <<: *PY37_BUILDER
